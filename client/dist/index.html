<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Automation Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: Arial, sans-serif;
        }
        .navbar {
            background-color: #1a1a1a;
            border-bottom: 1px solid #333;
        }
        .card {
            background-color: #1a1a1a;
            border: 1px solid #333;
            margin-bottom: 20px;
        }
        .btn-primary {
            background-color: #0095f6;
            border-color: #0095f6;
        }
        .btn-primary:hover {
            background-color: #0083e0;
            border-color: #0083e0;
        }
        .form-control {
            background-color: #262626;
            border-color: #333;
            color: #e0e0e0;
        }
        .form-control:focus {
            background-color: #262626;
            color: #e0e0e0;
            border-color: #0095f6;
            box-shadow: 0 0 0 0.25rem rgba(0, 149, 246, 0.25);
        }
        .login-container, .dashboard-container {
            max-width: 800px;
            margin: 50px auto;
        }
        #login-form, #register-form {
            margin-top: 20px;
        }
        #dashboard-view {
            display: none;
        }
        .stats-card {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .stats-value {
            font-size: 24px;
            font-weight: bold;
        }
        .activity-item {
            padding: 10px;
            border-bottom: 1px solid #333;
        }
        .activity-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <!-- Login/Register View -->
    <div id="auth-view">
        <div class="login-container">
            <div class="card">
                <div class="card-body">
                    <ul class="nav nav-tabs" id="authTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login-panel" type="button" role="tab" aria-controls="login-panel" aria-selected="true">Login</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register-panel" type="button" role="tab" aria-controls="register-panel" aria-selected="false">Register</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="authTabsContent">
                        <div class="tab-pane fade show active" id="login-panel" role="tabpanel" aria-labelledby="login-tab">
                            <form id="login-form">
                                <div class="mb-3">
                                    <label for="login-username" class="form-label">Username</label>
                                    <input type="text" class="form-control" id="login-username" required>
                                </div>
                                <div class="mb-3">
                                    <label for="login-password" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="login-password" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Login</button>
                                <div class="mt-3 text-danger" id="login-error"></div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="register-panel" role="tabpanel" aria-labelledby="register-tab">
                            <form id="register-form">
                                <div class="mb-3">
                                    <label for="register-username" class="form-label">Username</label>
                                    <input type="text" class="form-control" id="register-username" required>
                                </div>
                                <div class="mb-3">
                                    <label for="register-email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="register-email" required>
                                </div>
                                <div class="mb-3">
                                    <label for="register-password" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="register-password" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Register</button>
                                <div class="mt-3 text-danger" id="register-error"></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard View -->
    <div id="dashboard-view">
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Instagram Automation Tool</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" id="dashboard-tab">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="accounts-tab">Accounts</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="cookies-tab">Cookies</a>
                        </li>
                        <li class="nav-item admin-only" style="display: none;">
                            <a class="nav-link" href="#" id="admin-tab">Admin</a>
                        </li>
                    </ul>
                    <span class="navbar-text me-3" id="user-welcome">Welcome!</span>
                    <button class="btn btn-outline-danger" id="logout-btn">Logout</button>
                </div>
            </div>
        </nav>

        <div class="dashboard-container">
            <!-- Main Dashboard Panel -->
            <div id="dashboard-panel">
                <h2 class="mb-4">Dashboard</h2>
                
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card stats-card">
                            <div class="stats-value" id="accounts-count">0</div>
                            <div>Active Accounts</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card stats-card">
                            <div class="stats-value" id="cookies-count">0</div>
                            <div>Active Cookies</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card stats-card">
                            <div class="stats-value" id="activities-count">0</div>
                            <div>Activities</div>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Run Automation</h5>
                        <form id="automation-form">
                            <div class="mb-3">
                                <label for="automation-type" class="form-label">Automation Type</label>
                                <select class="form-control" id="automation-type" required>
                                    <option value="">Select type</option>
                                    <option value="follow">Follow User</option>
                                    <option value="unfollow">Unfollow User</option>
                                    <option value="like">Like Post</option>
                                    <option value="unlike">Unlike Post</option>
                                    <option value="comment">Comment on Post</option>
                                    <option value="profile_info">Get Profile Info</option>
                                    <option value="duplicates">Remove Duplicate Accounts</option>
                                </select>
                            </div>
                            <div class="mb-3" id="username-field">
                                <label for="automation-username" class="form-label">Username</label>
                                <input type="text" class="form-control" id="automation-username">
                            </div>
                            <div class="mb-3" id="post-url-field" style="display: none;">
                                <label for="automation-post-url" class="form-label">Post URL</label>
                                <input type="text" class="form-control" id="automation-post-url">
                            </div>
                            <div class="mb-3" id="comment-field" style="display: none;">
                                <label for="automation-comment" class="form-label">Comment</label>
                                <input type="text" class="form-control" id="automation-comment">
                            </div>
                            <button type="submit" class="btn btn-primary">Run</button>
                            <div class="mt-3" id="automation-result"></div>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Recent Activity</h5>
                        <div id="activity-list">
                            <div class="text-center">No activity yet</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Accounts Panel -->
            <div id="accounts-panel" style="display: none;">
                <h2 class="mb-4">Instagram Accounts</h2>
                
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Add New Account</h5>
                        <form id="add-account-form">
                            <div class="mb-3">
                                <label for="account-email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="account-email" required>
                            </div>
                            <div class="mb-3">
                                <label for="account-password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="account-password" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Add Account</button>
                            <div class="mt-3" id="add-account-result"></div>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Your Accounts</h5>
                        <div id="accounts-list">
                            <div class="text-center">No accounts yet</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cookies Panel -->
            <div id="cookies-panel" style="display: none;">
                <h2 class="mb-4">Instagram Cookies</h2>
                
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Add New Cookie</h5>
                        <form id="add-cookie-form">
                            <div class="mb-3">
                                <label for="cookie-account" class="form-label">Account</label>
                                <select class="form-control" id="cookie-account" required>
                                    <option value="">Select account</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="cookie-value" class="form-label">Cookie Value</label>
                                <textarea class="form-control" id="cookie-value" rows="5" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Add Cookie</button>
                            <div class="mt-3" id="add-cookie-result"></div>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Your Cookies</h5>
                        <div id="cookies-list">
                            <div class="text-center">No cookies yet</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="admin-panel" style="display: none;">
                <h2 class="mb-4">Admin Panel</h2>
                
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Manage Users</h5>
                        <div id="users-list">
                            <div class="text-center">Loading users...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Current user data
        let currentUser = null;
        let userAccounts = [];
        let userCookies = [];
        let userActivities = [];
        let allUsers = [];

        // DOM Elements
        const authView = document.getElementById('auth-view');
        const dashboardView = document.getElementById('dashboard-view');
        const userWelcome = document.getElementById('user-welcome');
        const logoutBtn = document.getElementById('logout-btn');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const loginError = document.getElementById('login-error');
        const registerError = document.getElementById('register-error');

        // Dashboard Panels
        const dashboardPanel = document.getElementById('dashboard-panel');
        const accountsPanel = document.getElementById('accounts-panel');
        const cookiesPanel = document.getElementById('cookies-panel');
        const adminPanel = document.getElementById('admin-panel');

        // Navigation Tabs
        const dashboardTab = document.getElementById('dashboard-tab');
        const accountsTab = document.getElementById('accounts-tab');
        const cookiesTab = document.getElementById('cookies-tab');
        const adminTab = document.getElementById('admin-tab');

        // Automation Form
        const automationType = document.getElementById('automation-type');
        const usernameField = document.getElementById('username-field');
        const postUrlField = document.getElementById('post-url-field');
        const commentField = document.getElementById('comment-field');
        const automationForm = document.getElementById('automation-form');
        const automationResult = document.getElementById('automation-result');

        // Stats Elements
        const accountsCount = document.getElementById('accounts-count');
        const cookiesCount = document.getElementById('cookies-count');
        const activitiesCount = document.getElementById('activities-count');

        // Lists
        const activityList = document.getElementById('activity-list');
        const accountsList = document.getElementById('accounts-list');
        const cookiesList = document.getElementById('cookies-list');
        const usersList = document.getElementById('users-list');
        const cookieAccount = document.getElementById('cookie-account');

        // Account Form
        const addAccountForm = document.getElementById('add-account-form');
        const addAccountResult = document.getElementById('add-account-result');

        // Cookie Form
        const addCookieForm = document.getElementById('add-cookie-form');
        const addCookieResult = document.getElementById('add-cookie-result');

        // Check if user is logged in
        async function checkAuth() {
            try {
                const response = await fetch('/api/user');
                if (response.ok) {
                    currentUser = await response.json();
                    showDashboard();
                } else {
                    showAuth();
                }
            } catch (error) {
                console.error('Error checking auth:', error);
                showAuth();
            }
        }

        // Login
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            loginError.textContent = '';
            
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                if (response.ok) {
                    currentUser = await response.json();
                    showDashboard();
                } else {
                    const error = await response.text();
                    loginError.textContent = error || 'Invalid username or password';
                }
            } catch (error) {
                console.error('Login error:', error);
                loginError.textContent = 'Network error. Please try again.';
            }
        });

        // Register
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            registerError.textContent = '';
            
            const username = document.getElementById('register-username').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            
            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password })
                });
                
                if (response.ok) {
                    currentUser = await response.json();
                    showDashboard();
                } else {
                    const error = await response.text();
                    registerError.textContent = error || 'Registration failed';
                }
            } catch (error) {
                console.error('Register error:', error);
                registerError.textContent = 'Network error. Please try again.';
            }
        });

        // Logout
        logoutBtn.addEventListener('click', async () => {
            try {
                await fetch('/api/logout', { method: 'POST' });
                currentUser = null;
                showAuth();
            } catch (error) {
                console.error('Logout error:', error);
            }
        });

        // Navigation
        dashboardTab.addEventListener('click', (e) => {
            e.preventDefault();
            showPanel(dashboardPanel);
            setActiveNavItem(dashboardTab);
        });

        accountsTab.addEventListener('click', (e) => {
            e.preventDefault();
            showPanel(accountsPanel);
            setActiveNavItem(accountsTab);
            loadAccounts();
        });

        cookiesTab.addEventListener('click', (e) => {
            e.preventDefault();
            showPanel(cookiesPanel);
            setActiveNavItem(cookiesTab);
            loadCookies();
            updateCookieAccountsDropdown();
        });

        adminTab.addEventListener('click', (e) => {
            e.preventDefault();
            showPanel(adminPanel);
            setActiveNavItem(adminTab);
            loadUsers();
        });

        // Automation Type Change
        automationType.addEventListener('change', () => {
            const type = automationType.value;
            
            // Reset fields
            usernameField.style.display = 'none';
            postUrlField.style.display = 'none';
            commentField.style.display = 'none';
            
            // Show relevant fields based on type
            if (['follow', 'unfollow', 'profile_info'].includes(type)) {
                usernameField.style.display = 'block';
            } else if (['like', 'unlike'].includes(type)) {
                postUrlField.style.display = 'block';
            } else if (type === 'comment') {
                postUrlField.style.display = 'block';
                commentField.style.display = 'block';
            }
        });

        // Run Automation
        automationForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            automationResult.innerHTML = '<div class="alert alert-info">Running automation...</div>';
            
            const type = automationType.value;
            const username = document.getElementById('automation-username').value;
            const postUrl = document.getElementById('automation-post-url').value;
            const commentText = document.getElementById('automation-comment').value;
            
            const data = { type };
            
            if (['follow', 'unfollow', 'profile_info'].includes(type)) {
                data.username = username;
            } else if (['like', 'unlike', 'comment'].includes(type)) {
                data.postUrl = postUrl;
                if (type === 'comment') {
                    data.commentText = commentText;
                }
            }
            
            try {
                const response = await fetch('/api/automation/run', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    automationResult.innerHTML = `<div class="alert alert-success">${result.message || 'Automation successful'}</div>`;
                    loadActivities();
                } else {
                    automationResult.innerHTML = `<div class="alert alert-danger">${result.message || 'Automation failed'}</div>`;
                }
            } catch (error) {
                console.error('Automation error:', error);
                automationResult.innerHTML = '<div class="alert alert-danger">Network error. Please try again.</div>';
            }
        });

        // Add Account
        addAccountForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            addAccountResult.innerHTML = '<div class="alert alert-info">Adding account...</div>';
            
            const email = document.getElementById('account-email').value;
            const password = document.getElementById('account-password').value;
            
            try {
                const response = await fetch('/api/instagram/accounts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                if (response.ok) {
                    addAccountResult.innerHTML = '<div class="alert alert-success">Account added successfully</div>';
                    document.getElementById('account-email').value = '';
                    document.getElementById('account-password').value = '';
                    loadAccounts();
                } else {
                    const error = await response.json();
                    addAccountResult.innerHTML = `<div class="alert alert-danger">${error.message || 'Failed to add account'}</div>`;
                }
            } catch (error) {
                console.error('Add account error:', error);
                addAccountResult.innerHTML = '<div class="alert alert-danger">Network error. Please try again.</div>';
            }
        });

        // Add Cookie
        addCookieForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            addCookieResult.innerHTML = '<div class="alert alert-info">Adding cookie...</div>';
            
            const accountId = document.getElementById('cookie-account').value;
            const cookieValue = document.getElementById('cookie-value').value;
            
            try {
                const response = await fetch('/api/instagram/cookies', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ accountId, cookieValue })
                });
                
                if (response.ok) {
                    addCookieResult.innerHTML = '<div class="alert alert-success">Cookie added successfully</div>';
                    document.getElementById('cookie-value').value = '';
                    loadCookies();
                } else {
                    const error = await response.json();
                    addCookieResult.innerHTML = `<div class="alert alert-danger">${error.message || 'Failed to add cookie'}</div>`;
                }
            } catch (error) {
                console.error('Add cookie error:', error);
                addCookieResult.innerHTML = '<div class="alert alert-danger">Network error. Please try again.</div>';
            }
        });

        // Load accounts
        async function loadAccounts() {
            try {
                const response = await fetch('/api/instagram/accounts');
                if (response.ok) {
                    userAccounts = await response.json();
                    updateAccountsList();
                    updateStats();
                }
            } catch (error) {
                console.error('Error loading accounts:', error);
            }
        }

        // Load cookies
        async function loadCookies() {
            try {
                const response = await fetch('/api/instagram/cookies');
                if (response.ok) {
                    userCookies = await response.json();
                    updateCookiesList();
                    updateStats();
                }
            } catch (error) {
                console.error('Error loading cookies:', error);
            }
        }

        // Load activities
        async function loadActivities() {
            try {
                const response = await fetch('/api/activity-logs?limit=10');
                if (response.ok) {
                    userActivities = await response.json();
                    updateActivitiesList();
                    updateStats();
                }
            } catch (error) {
                console.error('Error loading activities:', error);
            }
        }

        // Load users (admin only)
        async function loadUsers() {
            if (!currentUser.isAdmin) return;
            
            try {
                const response = await fetch('/api/admin/users');
                if (response.ok) {
                    allUsers = await response.json();
                    updateUsersList();
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        // Delete account
        async function deleteAccount(id) {
            try {
                const response = await fetch(`/api/instagram/accounts/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    loadAccounts();
                    loadCookies();
                }
            } catch (error) {
                console.error('Error deleting account:', error);
            }
        }

        // Delete cookie
        async function deleteCookie(id) {
            try {
                const response = await fetch(`/api/instagram/cookies/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    loadCookies();
                }
            } catch (error) {
                console.error('Error deleting cookie:', error);
            }
        }

        // Delete user (admin only)
        async function deleteUser(id) {
            try {
                const response = await fetch(`/api/admin/users/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    loadUsers();
                }
            } catch (error) {
                console.error('Error deleting user:', error);
            }
        }

        // Update accounts list
        function updateAccountsList() {
            if (userAccounts.length === 0) {
                accountsList.innerHTML = '<div class="text-center">No accounts yet</div>';
                return;
            }
            
            let html = '';
            userAccounts.forEach(account => {
                html += `
                <div class="card mb-2">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <div><strong>${account.username}</strong></div>
                            <div class="text-muted">${account.email}</div>
                        </div>
                        <button class="btn btn-sm btn-danger" onclick="deleteAccount(${account.id})">Delete</button>
                    </div>
                </div>
                `;
            });
            
            accountsList.innerHTML = html;
        }

        // Update cookies list
        function updateCookiesList() {
            if (userCookies.length === 0) {
                cookiesList.innerHTML = '<div class="text-center">No cookies yet</div>';
                return;
            }
            
            let html = '';
            userCookies.forEach(cookie => {
                const account = userAccounts.find(a => a.id === cookie.accountId);
                const accountName = account ? account.username : 'Unknown';
                
                html += `
                <div class="card mb-2">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <div><strong>Account: ${accountName}</strong></div>
                            <div class="text-muted">Created: ${new Date(cookie.createdAt).toLocaleString()}</div>
                        </div>
                        <button class="btn btn-sm btn-danger" onclick="deleteCookie(${cookie.id})">Delete</button>
                    </div>
                </div>
                `;
            });
            
            cookiesList.innerHTML = html;
        }

        // Update activities list
        function updateActivitiesList() {
            if (userActivities.length === 0) {
                activityList.innerHTML = '<div class="text-center">No activity yet</div>';
                return;
            }
            
            let html = '';
            userActivities.forEach(activity => {
                const statusClass = activity.status === 'success' ? 'text-success' : 'text-danger';
                
                html += `
                <div class="activity-item">
                    <div class="d-flex justify-content-between">
                        <div><strong>${activity.action}</strong></div>
                        <div class="${statusClass}">${activity.status}</div>
                    </div>
                    <div class="text-muted">${new Date(activity.createdAt).toLocaleString()}</div>
                </div>
                `;
            });
            
            activityList.innerHTML = html;
        }

        // Update users list (admin only)
        function updateUsersList() {
            if (allUsers.length === 0) {
                usersList.innerHTML = '<div class="text-center">No users found</div>';
                return;
            }
            
            let html = '';
            allUsers.forEach(user => {
                html += `
                <div class="card mb-2">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <div><strong>${user.username}</strong></div>
                            <div class="text-muted">${user.email}</div>
                            <div class="badge ${user.isAdmin ? 'bg-warning' : 'bg-secondary'}">${user.isAdmin ? 'Admin' : 'User'}</div>
                        </div>
                        ${!user.isAdmin ? `<button class="btn btn-sm btn-danger" onclick="deleteUser(${user.id})">Delete</button>` : ''}
                    </div>
                </div>
                `;
            });
            
            usersList.innerHTML = html;
        }

        // Update cookie accounts dropdown
        function updateCookieAccountsDropdown() {
            let html = '<option value="">Select account</option>';
            
            userAccounts.forEach(account => {
                html += `<option value="${account.id}">${account.username} (${account.email})</option>`;
            });
            
            cookieAccount.innerHTML = html;
        }

        // Update stats
        function updateStats() {
            accountsCount.textContent = userAccounts.length;
            cookiesCount.textContent = userCookies.length;
            activitiesCount.textContent = userActivities.length;
        }

        // Show auth view
        function showAuth() {
            authView.style.display = 'block';
            dashboardView.style.display = 'none';
        }

        // Show dashboard view
        function showDashboard() {
            // Update UI with user info
            userWelcome.textContent = `Welcome, ${currentUser.username}!`;
            
            // Show/hide admin tab
            document.querySelectorAll('.admin-only').forEach(el => {
                el.style.display = currentUser.isAdmin ? 'block' : 'none';
            });
            
            // Toggle views
            authView.style.display = 'none';
            dashboardView.style.display = 'block';
            
            // Show dashboard panel by default
            showPanel(dashboardPanel);
            setActiveNavItem(dashboardTab);
            
            // Load initial data
            loadAccounts();
            loadCookies();
            loadActivities();
        }

        // Show panel
        function showPanel(panel) {
            // Hide all panels
            dashboardPanel.style.display = 'none';
            accountsPanel.style.display = 'none';
            cookiesPanel.style.display = 'none';
            adminPanel.style.display = 'none';
            
            // Show selected panel
            panel.style.display = 'block';
        }

        // Set active nav item
        function setActiveNavItem(item) {
            // Remove active class from all nav items
            document.querySelectorAll('.nav-link').forEach(el => {
                el.classList.remove('active');
            });
            
            // Add active class to selected item
            item.classList.add('active');
        }

        // Global functions (for onclick)
        window.deleteAccount = deleteAccount;
        window.deleteCookie = deleteCookie;
        window.deleteUser = deleteUser;

        // Initialize
        checkAuth();
    </script>
</body>
</html>
